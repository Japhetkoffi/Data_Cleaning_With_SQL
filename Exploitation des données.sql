-- Exploitation des données
-- Nombre de licenciement par compagnie
select company , sum(total_laid_off)
from layoffs_2
group by company
order by 2 desc;

-- Nombre de licenciement par industrie
select industry , sum(total_laid_off)
from layoffs_2
group by industry
order by 2 desc;

-- Nombre de licenciement par pays
select country , sum(total_laid_off)
from layoffs_2
group by country
order by 2 desc;

-- Nombre de licenciement par année
select year(`date`) , sum(total_laid_off)
from layoffs_2
group by year(`date`)
order by 2 desc;

select*
from layoffs_2;

select * 
from layoffs_2
where percentage_laid_off =1;

select min(`date`), max(`date`)
from layoffs_2;

-- Nombre de licenciement entre une période donnée
SELECT company, SUM(total_laid_off) AS total_laid_off
FROM layoffs_2
WHERE `date` BETWEEN '2020-01-01' AND '2020-12-31'
GROUP BY company;

select substring(`date`,1,7) as `month`, sum(total_laid_off)
from layoffs_2
where substring(`date`,1,7) is not null 
group by `month`
order by 2 desc;

select* 
from layoffs_2
where year (`date`) is null;

-- Calcul de la somme cumulative des licenciements par mois en suivant l'ordre
with rolling_total as 
(
select substring(`date`,1,7) as `month`, sum(total_laid_off) as total_off
from layoffs_2
where substring(`date`,1,7) is not null 
group by `month`
order by 2 desc
)
select `month`, total_off, sum(total_off) over (order by `month`) as rolling_total
from rolling_total;

select sum(total_laid_off)
from layoffs_2
where `date` is not null;

-- Classement des compagnies suivant leur nombre de licenciement par ans 
WITH Company_Year AS (
    SELECT 
        company, 
        YEAR(`date`) AS years, 
        SUM(total_laid_off) AS total_laid_off
    FROM layoffs_2
    WHERE `date` IS NOT NULL
    GROUP BY company, YEAR(`date`)
), 
Company_Year_Rank AS (
    SELECT 
        *, 
        DENSE_RANK() OVER (PARTITION BY years ORDER BY total_laid_off DESC) AS Ranking
    FROM Company_Year
)
SELECT *
FROM Company_Year_Rank;

